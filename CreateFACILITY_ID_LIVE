// Feature Class: prcfBuilding
// Field: FACILITY_ID
// Triggers: Insert

// Set the feature class prefix.

var Prefix = "PKBL";

// Get the feature set.
var FS = $FeatureSet;

// Create an array to store numbers.
var Numbers = [];

// Iterate through the feature set.
for (var f in FS) {
    // Safely get numeric part after 4-character prefix. Set the field for which you iterate through below.
    var numPart = Right(f.FACILITY_ID, Count(f.FACILITY_ID) - 4);
    var n = Number(numPart);
    if (!IsNan(n)) {
        Push(Numbers, n);
    }
}

// Get the maximum number.
var MaxNumber = IIf(Count(Numbers) > 0, Max(Numbers), 0);

// Return next ID.
return Prefix + Number(MaxNumber + 1);
